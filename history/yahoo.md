* https://ideone.com/JMYxWu 組み合わせ
* https://ideone.com/1BBnAn 完全二分木, ヒープ
* https://ideone.com/XXBzri 掃き出し法
* https://ideone.com/cXZggx
* https://ideone.com/yHninE 列挙
* https://ideone.com/ATAjKL マインスイーパー
* https://ideone.com/EXb1p8 オセロ

#### 証明1

前提知識として「整数 n のビットを反転させると -n-1 となる」という仕様が存在していることを知っておく必要があります。たとえば 01000b (=8) のビットを反転させた 10111b は -9 です。

よって、n のビットを反転させたものに 1 を足すと -n になります。

「1 を足す」という操作を別の角度から見てみましょう。整数に 1 を足したとき、繰り上がりが終わるのは下位桁から見て初めて 0 が表れたときです。たとえば 10111b に 1 を足したとき、繰り上がりが終わるのは 4 番目です。

繰り上がりが終わる位置を i 番目とします。n と -n の i 桁目より上の桁については、ビットで見たときに必ず排他的であるため論理積を取ると 0 になります。 i 桁目より下の桁については、先ほどの議論により -n はすべて 0 であるため論理積を取っても 0 になります。i 桁目については、-n-1 に 1 を足したときに 0 から 1 に変化ししたため、論理積を取ると 1 になります。

よって、n と -n の論理積を取ると、i 桁目のみが 1 となります。

i 桁目はどこでしょうか。答えは n を2進数表記したときに下位桁から見て初めて 1 が表れるところです。これは 2 で割れる回数と一致します。


以上の議論から、2 で割れる回数は、n と -n の論理積から求めることができます。

#### 証明2

変数の個数を N 、自然数の和を S とおきます。

まず「 N 個の自然数からなる数列の和が S 」という問題は「 N 個の非負整数からなる数列の和が S' (=S - N) 」という問題に言い換えられます。

この言い換え後の問題は更に、右方向に N - 1 回、上方向に S' 回移動するような格子状での最短経路問題に言い換えることができます。

たとえば N = 4, S' = 2 の場合を考えます。このとき、右方向に 3 回、上方向に 2 回移動するような順列が決まれば、組み合わせが一意に決まります。具体的には、「→↑↑→→」のときは (0,2,0,0) 、「↑→→↑→」のときは (1,0,1,0) です。

ここまでで、元の問題を最短経路問題に言い換えることができました。よって、最短経路をランダムにひとつ決めることができれば、元の問題も解けることになります。

N - 1 + S' 個の要素からなる配列を考えます。このうちの N - 1 個は「→」で、残りは「↑」です。この配列を確率が均等になるようにシャッフルするには、「フィッシャー–イェーツのシャッフル」を使うと良いです。

※「フィッシャー–イェーツのシャッフル」は順列をシャッフルするアルゴリズムですが、「→」と「↑」の2つだけからなる配列であっても、確率が均等になるようにシャッフルできます。これは、同じ矢印を区別するものとしたときに、「→↑↑→→」と「↑→→↑→」の順列の個数が共に等しくなる（2!*3!=12 通り）ことから示せます。

ということで、元の問題が解けました。手順を整理します。

1. N と S から S' を求める
2. 長さ N - 1 + S' の整数型の配列を用意する
3. N - 1 個の要素を 0 とし、S' 個の要素を 1 とする（0:→、1:↑）
4. フィッシャー–イェーツのシャッフルによりシャッフル
5. 和が S となるような N 個の自然数からなる数列を求める
